# מסמך אפיון - מערכת תמיכה למשפחות יתומים וילדים חולים

**תאריך:** אוקטובר 2025
**סטטוס:** גרסה א' - בהכנת אישור
**מפתח:** [שם]
**סוג הפרויקט:** Web Application (Next.js + PostgreSQL)

---

## 1. סקירה כללית

מערכת ניהול תמיכות לעמותה המעניקה הערכות כספיות לשתי קבוצות יעד:
1. **מודול תמיכה לחתונות יתומים** — ניהול בקשות, תיקים, ותעבור כסף לחתונות
2. **מודול תמיכה לילדים חולים** — ניהול תשלומים חודשיים לניקיון משפחות עם ילד חולה

---

## 2. מודול תמיכה לחתונות יתומים

### 2.1 זרימת הבקשה — שלב 1: טופס חיצוני

**הערובים:**
- טופס ברואוז נפרד (לא חלק מהמערכת הפנימית)
- מהא"ם על ידי חתן/כלה

**שדות הטופס:**

#### קטע א: מידע החתונה
- תאריך עברי (חובה)
- תאריך לועזי (חובה)
- עיר (חובה)
- כמות מוזמנים (חובה)
- סה"כ עלות חתונה (קטרינג + אולם) (חובה)

#### קטע ב: מידע החתן והכלה
- **שם:** First Name, Last Name (חובה)
- **ת.ז.:** (חובה) — לחתן וכלה בנפרד
- **בית ספר:** (קוד בחירה / טקסט)
- **הורים:**
  - שם האב + עיסוק (קוד בחירה)
  - שם האם + עיסוק (קוד בחירה)
- **מצב משפחתי:** Single / Married (בחירה)
- **כתובת:** (חובה)
- **עיר:** (חובה)
- **טלפון:** (חובה)
- **מייל:** (חובה)
- **יום זיכרון:** (טקסט חופשי)
- **תיעוד רקע:** (textarea)

**פעולה בשליחה:**
- עובר לבדיקה למייל המזכירה
- **מייל:** כולל את כל פרטי הטופס + קישור ישיר למערכת

---

### 2.2 זרימת הבקשה — שלב 2: ניהול תיק במערכת

#### פתיחת התיק
- **מזכירה/מנהל:** מוכן מייל על הבקשה החדשה
- **פעולה:** לחיצה על כפתור **"התקבל"** במייל או בקישור ישיר
- **תיק נפתח:** מספר רץ אוטומטי + סטטוס **"חדש"**
- **ממשק:** צפייה בפרטי הטופס (לקריאה בלבד בשלב זה)

#### מסך התיק — 4 טאבים

**טאב 1: הבקשה בעברית**
- הצגה של כל פרטי הטופס בעברית
- מצב: לקריאה בלבד

**טאב 2: הבקשה באנגלית**
- תרגום אוטומטי של כל השדות والטופס לאנגלית (דרך API כמו Claude / ChatGPT)
- **כפתור:** "תרגם מחדש"
- **הכנסה ל־DB:** התרגום נשמר בטבלה נפרדת (לא מתרגם מחדש בכל ביקור)
- **עריכה:** ניתן לערוך תרגומים ידנית
- **שדות ניתנים לעריכה:** כל שדה בנפרד עם save אוטומטי

**טאב 3: מידע נוסף — קבצים**
- **הגבלת קבצים:** 5MB למקס לקובץ
- **סוגי קבצים:** PDF, JPG, PNG
- **שדות:**
  1. תפריט של החתונה
  2. הזמנה של החתונה
  3. תמונה של החתן/כלה
  4. מכתב תודה
- **אחסון:** קלאוד סטוראג' (vercel blob או s3)

**טאב 4: תשלומים**
- **מידע:**
  - פרטי חשבון בנק (בנק, סניף, מספר חשבון, שם בעל חשבון)
  - סכום החתונה (ממוקד מהטופס)
  - סכום תרומה בדולרים
  - **כפתור:** "המרה" — דולר ➜ שקל (שער עדכני)
  - סכום מאושר להעברה
  - **כפתור:** "העבר" ➜ מעביר לטבלת ההעברות

**אחרי העברה:**
- סכום העברה בפועל (לאחר אישור)
- תאריך העברה
- אסמכתא (reference)
- סטטוס: "הועבר"

**היסטוריית תשלומים:** (טאב 5 — אופציונלי לעתיד)
- רשימה של כל שינויי הסטטוס עם תאריכים וחותמת זמן

#### רצועת מידע כללית — מעל כל הטאבים

- **מס' תיק**
- **סטטוס:**
  - חדש
  - אושרה
  - ממתין להעברה
  - הועבר הסכום
  - נדחה
- **שם החתן/כלה**
- **תאריך החתונה** (עברי + לועזי)
- **כפתורים:** 
  - "דחה" (מחליף ל־"נדחה")
  - "אישור לעברה" (מחליף ל־"ממתין להעברה")

---

### 2.3 דשבורד ראשי

#### מצג: חצי מסך — לוח שנה עברי

- **בסיס:** לוח שנה עברית בלבד
- **כל תא (יום):** 
  - תאריך עברי + לועזי
  - רשימת החתונות באותו יום (עם שם זוג)
  - כמות מוזמנים / סכום הצפוי
- **ניווט:** חודשים עבריים (תשרי, חשוון, וכו')

#### סטטיסטיקות חודשיות (בחצי מסך שני)

- כמות בקשות חדשות החודש
- סכום כולל חתונות החודש
- כמות בקשות מאושרות להעברה
- סכום מאושר להעברה
- כמה כבר הועברו (סכום בפועל)

#### פעולות בדשבורד

- **כפתור:** "ניהול בקשות" ➜ עבור לרשימת כל התיקים
- **כפתור:** "סטטיסטיקות" ➜ דיווח חודשי/שנתי
- **כפתור:** "העברות" ➜ עבור לטבלת העברות

---

### 2.4 מודול העברות

#### טאב 1: העברות לאישור (ממתינות)

**טבלה עם עמודות:**
- תאריך
- משפחה (שם החתן/כלה)
- טלפון
- מספר תיק
- סכום בשקלים
- סכום בדולרים
- שם התורם
- שם בעל החשבון
- מספר זהות / בנק / סניף / מספר חשבון
- פרטים נוספים

**סינון:**
- לפי תאריך
- לפי סטטוס
- לפי שם משפחה

**ייצוא:**
- ✓ **Excel:** כל הטבלה כפי שמוצגת
- ✓ **Excel:** פורמט Masav (עבור מרכז סליקה בנקאי) — שימוש בספרייה `npm install masav`
- ✓ **Masav Direct:** כפתור לשליחה ישירה למרכז הסליקה

**בחירה סלקטיבית:**
- כל שורה עם checkBox
- בחירת רק השורות שרוצים
- ייצוא ל־Excel / Masav **רק למסומנות**
- **2 טאבים נפרדים:**
  - טאב "יתומים" ← העברות של חתונות
  - טאב "חולים" ← העברות של ניקיון
- כל משתמש בוחר מאיזה קטגוריה ישלח

**אחרי ייצוא:**
- מייל למזכירה: סיכום כמות העברות + סכום כולל + קובץ מצורף (אם צריך)
- סטטוס בתיק משתנה ל־ "הועבר הסכום" + תאריך/אסמכתא

#### טאב 2: היסטוריית העברות

**טבלה זהה לעל עם:**
- עמודה נוספת: "סטטוס" (הועבר בהצלחה / נכשל / בטיפול)
- עמודה: "תאריך העברה בפועל"
- עמודה: "אסמכתא"

**סינון:**
- לפי תאריך
- לפי סטטוס העברה
- לפי סכום
- לפי קטגוריה (יתומים / חולים)

---

## 3. מודול תמיכה לילדים חולים

### 3.1 טופס החיצוני

**מיל-אופ:**
- טופס חיצוני (לא חלק מהמערכת)
- המשפחה ממלאת פעם אחת

**שדות:**

- **ת.ז. הורים:** שדה אחד חובה מ־2 (אב / אם)
- **שם משפחה** (חובה)
- **שם הורה 1 + ת.ז.** (חובה)
- **שם הורה 2 + ת.ז.** (אופציונלי)
- **שם ילד חולה** (חובה)
- **כתובת** (חובה)
- **עיר** (חובה)
- **3 טלפונים** (לפחות אחד חובה)
- **מייל** (חובה)
- **פרטי בנק:**
  - מספר בנק
  - סניף
  - מספר חשבון
  - שם בעל החשבון
  (כל זה חובה)
- **תאריך התחלה של התמיכה** (חודש/שנה) — אופציונלי (יוגדר בעד לפתיחת התיק)
- **תאריך סיום** — אופציונלי (יוגדר אחר כך בעת סגירה)

**פעולה בשליחה:**
- מייל למזכירה כולל כל הפרטים
- **תיק נפתח אוטומטית** בסטטוס "פעיל"

---

### 3.2 ניהול התיק

#### טאב 1: פרטי הבקשה

- הצגת כל הפרטים מהטופס
- עמודה חדשה בתוך הטאב: "תקציר תיק" עם סיכומים:
  - תאריך התחלה (חודש)
  - תאריך סיום (ריק אם פעיל)
  - סכום כולל שהועבר (מצטבר)
  - חודשים פעילים (ספירה)

#### טאב 2: תשלומים חודשיים

**מחלוקת לחודשים (dynamic):**
- **בחירת חודש:** בחירה מ־dropdown של חודשים (מתחיל מחודש ההתחלה)
- **שדה סכום:** כניסת סכום חודשי (עד 720 ש"ח)
- **כפתור:** "שמור" + "העבר לתשלום"

**טבלת היסטוריה — מתחת**
- חודש | סכום | תאריך הזנה | סטטוס (מחכה / הועבר)

**אפשרות נוספת — טבלת "בחר הרבה משפחות"**
- המזכירה יכולה לבחור את כל המשפחות בחודש מסוים
- בחירה מ־dropdown של חודשים
- Checkboxes של משפחות
- כניסה סכום לכל משפחה דרך טבלה בודדת
- **כפתור:** "העבר הכל" ➜ מעביר את כל המשפחות שנבחרו לטבלת ההעברות

**סגירת תיק:**
- **כפתור:** "סגור תיק" (עם סיבה)
- **אפשרויות סגירה:**
  - "הילד הבריא"
  - "לצערנו הילד נפטר"
  - "סיוג התמיכה"
- **תוצאה:** סטטוס משתנה ל־ "לא פעיל" + תאריך סגירה

---

### 3.3 דשבורד / ניהול משפחות

**מסך ראשי:**
- רשימה של כל המשפחות בתמיכה הנוכחיים (פעילים בלבד)
- כל שורה: שם משפחה | שם ילד | תאריך התחלה | סכום שהועבר החודש | כפתור "פתח"

**סטטיסטיקות:**
- כמות משפחות פעילות
- סכום ממוצע בחודש
- סכום כולל החודש

**אוטומציה — שליחת מייל ב־1 לחודש:**
- **סכמה:** לכל משפחה פעילה
- **נושא:** "[שם משפחה] — דווח ניקיון לחודש [חודש]"
- **גוף:**
  - שלום [שם הורה],
  - בתחילת כל חודש אנו מבקשים ממך לדווח כמה עלה לך ניקיון ביתך.
  - כמות מאושרת: עד 720 ש"ח
  - בעזרתך אנחנו יכולים להמשיך לתמוך במשפחתך.
  - אנא השיבי מייל זה עם הסכום.
  - סיגנטורה עמותה
- **מימוש:** קרון job או NodeMailer cron

**מידע נוסף:**
- אין צורך בעדכון API חיצוני
- צריך מעקב אחרי מיילים שחזרו / לא נשלחו (אופציונלי לגרסה הבאה)

---

## 4. מודול העברות (משותף לשני הקטגוריות)

### 4.1 טבלת העברות

**2 טאבים:**
- **טאב "יתומים":** רק העברות של בקשות חתונה
- **טאב "חולים":** רק העברות של תמיכה חודשית

**עמודות:**
- Checkbox (בחירה סלקטיבית)
- תאריך
- משפחה
- טלפון
- מספר תיק
- סכום בשקלים
- סכום בדולרים (יתומים בלבד)
- שם התורם
- שם בעל החשבון
- מספר זהות / בנק / סניף / חשבון
- פרטים נוספים

### 4.2 סינון וייצוא

**סינונים:**
- לפי תאריך
- לפי משפחה
- לפי סטטוס
- לפי סכום

**ייצוא:**
- ✓ **Excel:** כל הטבלה כפי שמוצגת (רק מסומנים)
- ✓ **Excel Masav:** פורמט מיוחד למרכז סליקה בנקאי (רק מסומנים)
- ✓ **Masav Direct:** שליחה ישירה למרכז הסליקה (ספרייה: `masav`)

**אחרי ייצוא:**
- סטטוס בתיק: "הועבר הסכום"
- מייל למזכירה: סיכום העברה
- היסטוריה: רישום בטבלת ההעברות

---

## 5. ארכיטקטורה טכנית

### 5.1 סטאק טכנולוגי

- **Frontend:** Next.js (App Router)
- **Backend:** Next.js API Routes
- **Database:** PostgreSQL
- **Hosting:** Vercel
- **אחסון קבצים:** Vercel Blob / S3
- **תרגום:** Claude API / ChatGPT API
- **מייל:** Nodemailer (SMTP)
- **Masav:** ספרייה `masav` (npm)

### 5.2 מודל הנתונים — טבלות ראשיות

#### טבלה: `orphan_weddings_forms`
```
id (PK)
form_data (JSON) — כל פרטי הטופס
status (ENUM: new, approved, rejected)
created_at
email
```

#### טבלה: `orphan_weddings_files`
```
id (PK)
case_id (FK)
file_name
file_path (Vercel Blob / S3)
file_type (menu, invitation, photo, thank_you)
uploaded_at
file_size
```

#### טבלה: `orphan_weddings_translations`
```
id (PK)
case_id (FK)
language (EN / HE)
translated_data (JSON)
translated_at
edited_by_user (boolean)
```

#### טבלה: `orphan_weddings_cases`
```
id (PK) — מספר רץ
form_id (FK)
case_number (auto-generated)
status (ENUM: new, approved, pending_transfer, transferred, rejected)
wedding_date_hebrew
wedding_date_gregorian
groom_name
bride_name
bride_id
groom_id
total_cost
donation_amount_usd
donation_amount_ils
bank_details_id (FK)
approved_amount_ils
case_created_at
case_updated_at
```

#### טבלה: `orphan_weddings_bank_details`
```
id (PK)
case_id (FK)
bank_number
branch
account_number
account_holder_name
```

#### טבלה: `orphan_weddings_transfers`
```
id (PK)
case_id (FK)
transfer_date
amount_ils
transfer_status (pending, completed, failed)
reference_number
actual_transfer_date
created_at
```

#### טבלה: `sick_children_forms`
```
id (PK)
form_data (JSON)
status (ENUM: active, inactive)
created_at
parent_id
child_name
bank_details_id (FK)
start_date (חודש/שנה)
end_date (NULL אם פעיל)
end_reason (healed, deceased, null)
```

#### טבלה: `sick_children_monthly_support`
```
id (PK)
case_id (FK)
month (ENUM: 1-12)
year
amount_ils (up to 720)
amount_reported_by_parent (boolean)
payment_status (pending, transferred, failed)
payment_date
created_at
reported_at
```

#### טבלה: `general_transfers`
```
id (PK)
case_id (FK)
case_type (ENUM: wedding, sick_child)
transfer_date
amount_ils
status (pending, completed)
reference_number
created_at
```

### 5.3 JSON Storage — שימושים

- **orphan_weddings_forms.form_data:** כל פרטי הטופס המקורי
- **orphan_weddings_translations.translated_data:** התרגום לאנגלית (ניתן לעריכה)
- **sick_children_forms.form_data:** כל פרטי הטופס המקורי

**הנמקה:** גמישות בהוספת שדות חדשים בעתיד ללא שינוי סכמת ה־DB

### 5.4 רשאות

- **משתמש:** מזכירה + מנהלים (אין הבדל בעיקרון)
- **גישה:** גישה מלאה לכל המערכת
- **עבור הגרסה הבאה:** שקול הוספת רשאות (מדעיך, צוות הטבעות)

---

## 6. זרימות עיקריות

### 6.1 זרימת בקשה לחתונה יתומים

```
1. חתן/כלה ממלאים טופס חיצוני
   ↓
2. המערכת שולחת מייל למזכירה (כל הפרטים)
   ↓
3. מזכירה לוחצת "התקבל" בלחיצה על קישור/כפתור
   ↓
4. תיק נפתח עם מספר רץ + סטטוס "חדש"
   ↓
5. מזכירה בודקת ומעוניינת להציע תרומה
   ↓
6. מזכירה לוחצת "אישור להעברה" → סטטוס = "ממתין להעברה"
   ↓
7. בטאב "תשלומים" — כניסת פרטי בנק וסכום
   ↓
8. לחיצה "העבר" → מעבור לטבלת העברות
   ↓
9. בטבלת העברות — בחירה של העברות לשליחה
   ↓
10. ייצוא ל־Excel / Masav או שליחה ישירה
   ↓
11. סטטוס בתיק משתנה ל־ "הועבר הסכום"
   ↓
12. מייל למזכירה: סיכום העברה
```

### 6.2 זרימת תמיכה לילד חולה

```
1. הורה ממלא טופס חיצוני
   ↓
2. המערכת שולחת מייל למזכירה (כל הפרטים)
   ↓
3. תיק נפתח אוטומטית + סטטוס "פעיל"
   ↓
4. בכל חודש (1 ביום) — שליחת מייל להורה דיווח ניקיון
   ↓
5. הורה משיב במייל עם הסכום (עד 720 ש"ח)
   ↓
6. מזכירה מכניסה את הסכום בטאב "תשלומים"
   ↓
7. לחיצה "העבר" → מעבור לטבלת העברות
   ↓
8. בטבלת העברות — בחירה של משפחות לשליחה
   ↓
9. ייצוא ל־Excel / Masav
   ↓
10. סטטוס משתנה ל־ "הועבר הסכום"
   ↓
11. כשהילד מחלים או לצערנו — סגירת תיק (כפתור "סגור תיק")
```

---

## 7. תעדוף פתוח / חוקי עיצוב

### 7.1 הנחיות ממשק

- **עברית:** RTL (right-to-left)
- **ניווט:** תפריט עיקרי עם אפשרויות: דשבורד, חתונות, חולים, העברות
- **Responsive:** תמיכה במכשירים ניידים (אם צריך — לבדוק אחר כך)
- **צבעים:** להגדיר (TBD)
- **גופנים:** Heebo / Rubik (עברית טובה)

### 7.2 בדיקות

- **Unit Tests:** API Routes + Utilities
- **E2E Tests:** זרימות חתונה + ילדים חולים (Playwright / Cypress)
- **Manual Testing:** טופס חיצוני → טיק → העברה

### 7.3 אבטחה

- **Authentication:** משתמש מזכירה (TBD — אם צריך login)
- **HTTPS:** כל התקשורת מוצפנת (Vercel)
- **Environment Variables:** API Keys (Claude, Nodemailer, Masav)
- **Rate Limiting:** בטופס חיצוני (למניעת spam)

---

## 8. לוח זמנים משוער (אומדן)

- **פאז 1 — ניהול בקשות (חתונות):** 3-4 שבועות
- **פאז 2 — ניהול תשלומים (חתונות):** 2 שבועות
- **פאז 3 — מודול ילדים חולים:** 2 שבועות
- **פאז 4 — מודול העברות + Masav:** 2 שבועות
- **פאז 5 — דשבורד + אוטומציות:** 1-2 שבועות
- **בדיקות + עיגולי עברה:** 1 שבוע

**סה"כ משוער:** 11-16 שבועות (תלוי בסיבוכיות בפועל)

---

## 9. הערות ושאלות פתוחות

### 9.1 הערות

1. **לוח שנה עברי:** ספרייה מומלצת — `date-fns` או `moment-hijri` עם hebrew calendar wrapper
2. **תרגום:** Claude API או ChatGPT — בחר לפי עלות וביצועים
3. **Masav:** בדוק דרישות דקות של פורמט (BIC / IBAN בישראל?)
4. **טופס חיצוני:** שקול Vercel Forms או Google Forms עם webhook
5. **היסטוריית שינויים:** מומלץ להוסיף audit log (תאריך + שם משתמש + שינוי)

### 9.2 שאלות לאישור

1. האם צריך **backup יומי** של ה־DB?
2. האם צריך **הרשאות ניהולית** לגרסה הבאה (מדעיך / מנהל ארגון)?
3. האם צריך **דיווח חודשי/שנתי** אוטומטי (Excel / PDF)?
4. האם צריך **אינטגרציה לתוכנת חשבונאות** (ייצוא לחשבונאי)?
5. האם הטופס החיצוני צריך להיות **Multi-step form** או **single page**?

---

## 10. נספחים

### 10.1 דוגמת JSON — פרטי בקשה חתונה

```json
{
  "bride_info": {
    "first_name": "שרה",
    "last_name": "לוי",
    "id": "123456789",
    "school": "תיכון דוד",
    "father_name": "יוסף לוי",
    "father_occupation": "מהנדס",
    "mother_name": "חנה לוי",
    "mother_occupation": "מורה",
    "children_status": "none",
    "address": "רחוב הרמוניה 10",
    "city": "ירושלים",
    "email": "sarah@example.com",
    "phone": "0501234567",
    "memorial_day": "ט בתשרי"
  },
  "groom_info": {
    "first_name": "דוד",
    "last_name": "כהן",
    "id": "987654321",
    "school": "תיכון תורת חיים",
    "father_name": "משה כהן",
    "father_occupation": "עורך דין",
    "mother_name": "רבקה כהן",
    "mother_occupation": "רופאה",
    "children_status": "none",
    "address": "רחוב הציונות 5",
    "city": "תל אביב",
    "email": "david@example.com",
    "phone": "0509876543",
    "memorial_day": "כ בחשוון"
  },
  "wedding_info": {
    "date_hebrew": "כ בתשרי תשפה",
    "date_gregorian": "2024-10-15",
    "city": "ירושלים",
    "guest_count": 250,
    "total_cost": 45000
  },
  "background_info": "משפחה מכובדת..."
}
```

### 10.2 דוגמת JSON — פרטי תמיכה ילדים חולים

```json
{
  "parents_info": {
    "primary_parent_id": "111222333",
    "primary_parent_name": "מרים דוד",
    "secondary_parent_id": "444555666",
    "secondary_parent_name": "דניאל דוד"
  },
  "family_info": {
    "family_name": "דוד",
    "child_name": "ליאור דוד",
    "address": "רחוב המלאכים 7",
    "city": "פתח תקווה"
  },
  "contact_info": {
    "phones": [
      "0521111111",
      "0522222222",
      "0523333333"
    ],
    "email": "david.family@example.com"
  },
  "bank_info": {
    "bank_number": 10,
    "branch": 123,
    "account_number": 1234567,
    "account_holder": "מרים דוד"
  },
  "support_dates": {
    "start_month": "אוקטובר 2024",
    "end_month": null,
    "end_reason": null
  }
}
```

### 10.3 Workflow — תרגום אנגלית

```
טריגר: המזכירה לוחצת "תרגם" בטאב 2 (אנגלית)

1. קח את form_data מטבלה orphan_weddings_forms
2. שלח ל־Claude API עם prompt:
   "תרגם את הטופס הבא לאנגלית. שמור את המבנה וערכי Enums.
    החזר JSON בדיוק באותו מבנה אבל בעברית ↔ אנגלית"
3. קבל את התוצאה ושמור בטבלה orphan_weddings_translations
4. הצג בטאב 2 עם שדות ניתנים לעריכה
5. כל שינוי ידני ישומר עם flag "edited_by_user = true"
```

### 10.4 Flow — Masav Export

```
טריגר: המזכירה בוחרת שורות וכפתור "ייצוא למסב"

1. אוסף את המסומנים מטבלת general_transfers
2. בנה JSON בפורמט Masav (לפי טבלת הפרמטרים):
   - beneficiary name
   - bank number
   - branch
   - account
   - amount ILS
   - reference

3. שתמש בספרייה masav:
   ```javascript
   import { createPaymentFile } from 'masav';
   const paymentData = [...];
   const masavFile = createPaymentFile(paymentData);
   ```

4. הורד כקובץ binary או שלח ישירות למרכז סליקה (תלוי ב־API של Masav)
5. עדכן את סטטוס התיקים ל־"הועבר הסכום"
6. שלח מייל למזכירה עם סיכום
```

### 10.5 Flow — Cron Job — מייל חודשי (ילדים חולים)

```
Cron: בכל ראשון של חודש בשעה 08:00

1. Query: SELECT * FROM sick_children_forms WHERE status = 'active'
2. FOR EACH משפחה פעילה:
   - בנה מייל:
     נושא: "[שם משפחה] — דווח ניקיון לחודש [חודש]"
     גוף: "שלום [שם הורה], בתחילת חודש זה אנחנו מבקשים..."
   - שלח דרך Nodemailer
   - רשום בטבלה sick_children_monthly_support בעמודה reported_at
3. LOG: כמה מיילים נשלחו בהצלחה / כשלו
4. (אופציונלי) שלח מייל למזכירה: "נשלחו X מיילים להורים"
```

---

## 11. דרישות Non-Functional

### 11.1 ביצועים

- **זמן טעינת עמוד:** < 2 שניות (First Contentful Paint)
- **DB queries:** < 500ms לשאילתה
- **ייצוא Excel:** < 30 שניות (עד 10,000 שורות)
- **תרגום API:** < 10 שניות (קלוד / ChatGPT)

### 11.2 זמינות

- **Uptime:** 99.5% (Vercel)
- **Backup:** יומי (DB snapshots)
- **Disaster Recovery:** פרט תוכנית בפאז ב'

### 11.3 אבטחה

- **HTTPS:** כל התקשורת
- **CORS:** מוגבל לדומיין העמותה
- **Input Validation:** כל inputים מ־frontend
- **SQL Injection Prevention:** Parameterized queries (Prisma / Knex)
- **Rate Limiting:** 100 בקשות / דקה לכל IP (טופס חיצוני)

### 11.4 Compliance

- **GDPR / Privacy:**
  - אפשרות מחיקה / anonymization של מידע חסוי (הורים / ילדים)
  - מדיניות שימור נתונים (כמה שנים?)
  - מייל opt-out (חולים)

---

## 12. פעולות עבור גרסה 2 (לעתיד)

- [ ] **Audit Log:** רשימה של כל שינויי התיקים עם זמנים וש״ם משתמש
- [ ] **Advanced Reports:** דוח שנתי PDF, אנליטיקה (Excel Pivot Tables)
- [ ] **Multi-User Permissions:** הבחנה בין מדעיך ← → מנהל כללי
- [ ] **Dashboard Graphs:** תרשימים (Recharts / Chart.js) של נתונים
- [ ] **SMS Notifications:** הודעות SMS (לטלפונים של הורים / חתנים)
- [ ] **Mobile App:** אפליקציה native או PWA
- [ ] **API Export:** REST API לשיתוף נתונים עם מערכות חיצוניות
- [ ] **Email Template Editor:** בנאי תבניות מייל בלי קוד
- [ ] **Multi-Language:** תמיכה בעברית + אנגלית + עברברית (UI)
- [ ] **Payment Gateway Integration:** קישור ל־Stripe / PayPal (תרומות אונליין)

---

## 13. חתימה ואישור

| תפקיד | שם | חתימה | תאריך |
|-------|-----|--------|-------|
| **מפתח** | [שם] | ______ | ______ |
| **מנהל/ת פרויקט** | [שם] | ______ | ______ |
| **ייצוג עמותה** | [שם] | ______ | ______ |

---

**גרסה:** 1.0
**תאריך עדכון אחרון:** אוקטובר 2025
**מצב:** בהמתנה לאישור